<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta content=''>
		<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.css' rel='stylesheet' />
		<link href='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/codemirror.min.css' rel='stylesheet' />
		<link href='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/theme/monokai.min.css' rel='stylesheet' />
		<!-- <link href='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/addon/scroll/simplescrollbars.min.css' rel='stylesheet' /> -->
		<link rel='stylesheet' type='text/css' href='./index.css'>
		<script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
		<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.43.0/mapbox-gl.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/codemirror.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/keymap/sublime.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/mode/sql/sql.min.js'></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.33.0/addon/scroll/simplescrollbars.min.js'></script>
		<style></style>
	</head>
	<body>
		<div id='app'>
			<header>
				<p id='title'>
					<a href='https://github.com/jvail/spatiasql.js'>spatiasql.js</a>
					 - query sample db or choose a file
					 (<a href='https://www.gaia-gis.it/fossil/libspatialite/index'>SpatiaLite</a>
					 or
					 <a href='http://www.geopackage.org/#sampledata'>GeoPackage</a>).</p>
			</header>
			<div id='main'>
				<div id='control'>
					<div id='panel'>
						<button id='run'>run query</button>
						<input id='file' type='file'/>
						<span id='error'></span>
						<span id='time'></span>
					</div>
					<div id='tbl'></div>
					<div id='editor'>
						<textarea id='code' name='code'>
/*
  Sample db from https://www.gaia-gis.it/
  Editor has Sublime shortcuts enabled.
  You can draw a geometry on the map by including 'geojson' in a column name.
*/

-- SELECT * FROM sqlite_master WHERE type='table'

SELECT AsGeoJSON(Transform(HexagonalGrid(ST_Union(geometry), 10000), 4326), 6) AS geojson
FROM regions
WHERE  name='TOSCANA'
AND IsValid(geometry)
UNION
SELECT AsGeoJSON(Transform(Simplify(geometry, 1000), 4326), 6) AS geojson
FROM highways
WHERE Within(geometry, (SELECT Collect(geometry) FROM regions WHERE name='TOSCANA'))
AND length(geometry) > 10000
UNION
SELECT AsGeoJSON(Transform(geometry, 4326), 6) AS geojson
FROM towns
WHERE Within(geometry, (SELECT Collect(geometry) FROM regions WHERE name='TOSCANA'))
AND peoples > 10000;
						</textarea>
					</div>
				</div>
				<div id='map'></div>
			</div>
		</div>
		<script src='./index.js'></script>
	</body>
</html>
